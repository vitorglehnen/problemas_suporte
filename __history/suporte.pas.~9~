unit suporte;
interface
uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, Vcl.Grids, Vcl.DBGrids,
  Vcl.ExtCtrls, Vcl.StdCtrls, Vcl.DBCtrls, FireDAC.Stan.Intf,
  FireDAC.Stan.Option, FireDAC.Stan.Error, FireDAC.UI.Intf, FireDAC.Phys.Intf,
  FireDAC.Stan.Def, FireDAC.Stan.Pool, FireDAC.Stan.Async, FireDAC.Phys,
  FireDAC.Phys.MySQL, FireDAC.Phys.MySQLDef, FireDAC.VCLUI.Wait,
  FireDAC.Stan.Param, FireDAC.DatS, FireDAC.DApt.Intf, FireDAC.DApt,
  FireDAC.Comp.DataSet, FireDAC.Comp.Client, Vcl.Buttons, Vcl.Mask,
  Vcl.WinXPanels;
type
  TformPrincipal = class(TForm)
    pnlBodyProblemas: TPanel;
    pnlTopProblemas: TPanel;
    pnlGridProblemas: TPanel;
    gridProblemas: TDBGrid;
    lblTituloProblemas: TLabel;
    pnlBodyModulos: TPanel;
    pnlTopModulos: TPanel;
    lblTituloModulos: TLabel;
    pnlGridModulos: TPanel;
    gridModulos: TDBGrid;
    pnlBotoesProblemas: TPanel;
    btnNovoProblema: TSpeedButton;
    btnSalvarProblema: TSpeedButton;
    btnExcluirProblema: TSpeedButton;
    btnCancelarProblema: TSpeedButton;
    pnlBotoesModulos: TPanel;
    btnNovoModulo: TSpeedButton;
    btnSalvarModulo: TSpeedButton;
    btnExcluirModulo: TSpeedButton;
    btnCancelarModulo: TSpeedButton;
    pnlPesquisaProblemas: TPanel;
    pnlPesquisaModulos: TPanel;
    edtPesquisaModulo: TEdit;
    lblPesquisaModulos: TLabel;
    edtPesquisaProblema: TEdit;
    Label4: TLabel;
    rdbtnFiltroPesquisaProblemas: TRadioGroup;
    pnlPrincipal: TPanel;
    pnlBodyModulosProblemas: TPanel;
    OpenDialog1: TOpenDialog;
    CardPanel1: TCardPanel;
    pnlCadastroProblema: TCard;
    pnlImagensProblema: TCard;
    pnlProblemas: TPanel;
    lblModuloProblema: TLabel;
    lblDetalhesProblema: TLabel;
    lblSolucaoProblema: TLabel;
    pnlTituloProblema: TPanel;
    lblTituloProblema: TLabel;
    lblDataProblema: TLabel;
    edtTituloProblema: TDBEdit;
    edtHoraProblema: TDBEdit;
    mmDetalhesProblema: TDBMemo;
    mmSolucao: TDBMemo;
    cbModulos: TDBComboBox;
    Button1: TButton;
    Button2: TButton;
    DBImage1: TDBImage;
    DBImage2: TDBImage;
    Button3: TButton;
    procedure btnNovoProblemaClick(Sender: TObject);
    procedure btnSalvarProblemaClick(Sender: TObject);
    procedure gridModulosMouseWheel(Sender: TObject; Shift: TShiftState;
      WheelDelta: Integer; MousePos: TPoint; var Handled: Boolean);
    procedure gridModulosCellClick(Column: TColumn);
    procedure FormShow(Sender: TObject);
    procedure btnExcluirProblemaClick(Sender: TObject);
    procedure btnCancelarProblemaClick(Sender: TObject);
    procedure btnNovoModuloClick(Sender: TObject);
    procedure btnSalvarModuloClick(Sender: TObject);
    procedure btnCancelarModuloClick(Sender: TObject);
    procedure btnExcluirModuloClick(Sender: TObject);
    procedure edtPesquisaModuloChange(Sender: TObject);
    procedure edtPesquisaProblemaChange(Sender: TObject);
    procedure Button3Click(Sender: TObject);
  private
    procedure PreencheCBModulos;
    procedure AtivaBotoesProblema;
    procedure AtualizaGridProblemas;
    { Private declarations }
  public
    { Public declarations }
  end;
var
  formPrincipal: TformPrincipal;

implementation
{$R *.dfm}

uses dm;

procedure TformPrincipal.gridModulosCellClick(Column: TColumn);
begin
  AtualizaGridProblemas;
end;

procedure TformPrincipal.gridModulosMouseWheel(Sender: TObject; Shift: TShiftState;
  WheelDelta: Integer; MousePos: TPoint; var Handled: Boolean);
begin
  AtualizaGridProblemas;
end;

procedure TformPrincipal.edtPesquisaModuloChange(Sender: TObject);
begin
  with dmQuerys.qModulos do
  begin
    close;
    sql.Clear;
    Sql.Add('select * from modulos_problemas where mo_nome like :ParamModulo');
    ParamByName('ParamModulo').AsString := '%' + edtPesquisaModulo.Text + '%';
    Open;
  end;
end;

procedure TformPrincipal.edtPesquisaProblemaChange(Sender: TObject);
begin
  if rdbtnFiltroPesquisaProblemas.ItemIndex = 0 then
  begin
    with dmQuerys.qProblemas do
    begin
      close;
      sql.Clear;
      Sql.Add('select * from problema where pr_problema like :ParamProblema');
      ParamByName('ParamProblema').AsString := '%' + edtPesquisaProblema.Text + '%';
      Open;
    end;
  end;

  if rdbtnFiltroPesquisaProblemas.ItemIndex = 1 then
  begin
    with dmQuerys.qProblemas do
    begin
      close;
      sql.Clear;
      Sql.Add('select * from problema where pr_problema like :ParamProblema and pr_modulo = :ParamProblema1');
      ParamByName('ParamProblema').AsString := '%' + edtPesquisaProblema.Text + '%';
      ParamByName('ParamProblema1').AsString := gridModulos.Columns[0].Field.Value;
      Open;
    end;
  end;
end;

procedure TformPrincipal.FormShow(Sender: TObject);
begin
  PreencheCBModulos;
end;


procedure TformPrincipal.AtivaBotoesProblema;
begin
  btnNovoProblema.Enabled := True;
  btnSalvarProblema.Enabled := True;
  btnCancelarProblema.Enabled := True;
  btnExcluirProblema.Enabled := True;
end;

procedure TformPrincipal.AtualizaGridProblemas;
begin
  with dmQuerys.qProblemas do
  begin
    close;
    sql.Clear;
    Sql.Add('select * from problema where pr_modulo = :ParamModulo');
    ParamByName('ParamModulo').AsString := gridModulos.Columns[0].Field.Value;
    Open;
  end;

  AtivaBotoesProblema;
end;

procedure TformPrincipal.PreencheCBModulos;
begin
  cbModulos.Clear;

  with dmQuerys.qComboModulos do
  begin
    Close;
    SQL.Clear;
    SQL.ADD('Select * from modulos_problemas');
    Open;
    First;
    while not dmQuerys.qComboModulos.Eof do
    begin
      cbModulos.items.add(dmquerys.qComboModulos['mo_nome']);
      Next;
    end;
  end;
end;
procedure TformPrincipal.btnCancelarModuloClick(Sender: TObject);
begin
  dmQuerys.qModulos.Cancel;
end;

procedure TformPrincipal.btnCancelarProblemaClick(Sender: TObject);
begin
  dmQuerys.qProblemas.Cancel;
end;

procedure TformPrincipal.btnExcluirModuloClick(Sender: TObject);
begin
  if Application.MessageBox('Deseja excluir este módulo?', 'Excluir',
    + MB_ICONQUESTION + MB_YESNO) = MrYes then
    begin
      dmQuerys.qModulos.Delete;
    end;
end;

procedure TformPrincipal.btnExcluirProblemaClick(Sender: TObject);
begin
   if Application.MessageBox('Deseja excluir este problema?', 'Excluir',
    + MB_ICONQUESTION + MB_YESNO) = MrYes then
    begin
      dmQuerys.qProblemas.Delete;
    end;
end;

procedure TformPrincipal.btnNovoModuloClick(Sender: TObject);
begin
  dmQuerys.qModulos.Insert;
end;

procedure TformPrincipal.btnNovoProblemaClick(Sender: TObject);
begin
  dmQuerys.qProblemas.Insert;
  PreencheCBModulos;
  edtTituloProblema.SetFocus;
end;

procedure TformPrincipal.btnSalvarModuloClick(Sender: TObject);
begin
  dmQuerys.qModulos.Post;
end;

procedure TformPrincipal.btnSalvarProblemaClick(Sender: TObject);
begin
  dmQuerys.qProblemas.Post;
end;

procedure TformPrincipal.Button3Click(Sender: TObject);
begin
  CardPanel1.ActiveCard := pnlImagensProblema;
end;

end.
